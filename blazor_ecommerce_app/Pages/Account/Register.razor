@page "/register";
@inject NavigationManager NavigationManager
<div class="col-12">


    <div class="col-4 mx-auto">
        <Syncfusion.Blazor.DataForm.SfDataForm 
                Model="@Model"  
                OnSubmit="RegisterHandle"
        >
            <div class="mb-3 text-center">
                <img src="/img/login.jpg" style="max-height:5rem" />
                <h3>Register</h3>
            </div>
            <FormValidator>
                <DataAnnotationsValidator></DataAnnotationsValidator>
            </FormValidator>
            <FormItems>
                <FormItem Field="@nameof(Model.Username)"></FormItem>
                <FormItem Field="@nameof(Model.Email)"></FormItem>
                <FormItem EditorType="@FormEditorType.Password" Field="@nameof(Model.Password)"></FormItem>
                <FormItem EditorType="@FormEditorType.Password" Field="@nameof(Model.PasswordRepeat)"></FormItem>
            </FormItems>
        </Syncfusion.Blazor.DataForm.SfDataForm>
    </div>
</div>

@code {

    public DB.Models.RegisterModel Model { get; set; } = new();

    public async Task RegisterHandle(EditContext model)
    {

        try
        {
            var item = model.Model as DB.Models.RegisterModel;
            await Mediator.Send(new DB.Modules.Authentication.Register.Register.Request()
                {
                    Email = item.Email,
                    Password = item.Password,
                    PasswordRepeat = item.PasswordRepeat,
                    UserName = item.Username
                });
            await Mediator.Send(new DB.Modules.Authentication.Login.Login.Request()
                {
                    Password = item.Password,
                    Username = item.Username
                });
            Notifiaction.ShowToast(new Service.Notification.ToastOption()
                {
                    Content = "Login successful",
                    Type = Service.Notification.ToastType.succes
                });
            NavigationManager.NavigateTo("/");
        }
        catch (Exception ex)
        {
            Notifiaction.ShowToast(new Service.Notification.ToastOption()
                {
                    Content = ex.Message,
                     Type = Service.Notification.ToastType.error
                });
        }
    }

}
